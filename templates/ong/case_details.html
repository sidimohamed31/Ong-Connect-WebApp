{% extends 'base.html' %}

{% block content %}
<!-- Case Details Container -->
<div class="case-details-wrapper">
    <div class="container">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('ong_profile') }}">{{ t.my_profile }}</a></li>
                <li class="breadcrumb-item active">{{ t.case_details }}</li>
            </ol>
        </nav>

        <!-- Case Header -->
        <div class="case-detail-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="case-detail-title">{{ case.titre }}</h1>
                </div>
                <div class="col-md-4 text-end">
                    <span class="status-badge-large status-{{ case.statut|replace(' ', '_')|lower }}">
                        {{ t.get(case.statut, case.statut) }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Case Information Grid -->
        <div class="row g-4 mt-4">
            <div class="col-md-8">
                <!-- Description Card -->
                <div class="info-card">
                    <div class="card-icon">
                        <i class="bi bi-file-text"></i>
                    </div>
                    <h3>{{ t.description }}</h3>
                    <p class="case-description-full">{{ case.description }}</p>
                </div>

                <!-- Media Gallery -->
                {% if media_list %}
                <div class="info-card mt-4">
                    <div class="card-icon">
                        <i class="bi bi-images"></i>
                    </div>
                    <h3>{{ t.media_gallery }}</h3>
                    <div class="media-gallery">
                        {% for media in media_list %}
                        <div class="media-item">
                            {% if media.file_url.endswith(('.jpg', '.jpeg', '.png', '.gif', '.webp')) %}
                            <img src="{{ url_for('static', filename=media.file_url) }}" alt="Media" class="media-image"
                                data-bs-toggle="modal" data-bs-target="#mediaModal{{ loop.index }}">
                            {% elif media.file_url.endswith(('.mp4', '.webm', '.ogg')) %}
                            <video class="media-video" controls>
                                <source src="{{ url_for('static', filename=media.file_url) }}" type="video/mp4">
                            </video>
                            {% endif %}
                        </div>

                        <!-- Media Modal -->
                        <div class="modal fade" id="mediaModal{{ loop.index }}" tabindex="-1">
                            <div class="modal-dialog modal-lg modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-body p-0">
                                        <img src="{{ url_for('static', filename=media.file_url) }}" class="img-fluid">
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Beneficiaries List -->
                {% if beneficiaries %}
                <div class="info-card mt-4">
                    <div class="card-icon">
                        <i class="bi bi-people"></i>
                    </div>
                    <h3>{{ t.beneficiaries_list }}</h3>
                    <div class="beneficiaries-list">
                        {% for beneficiary in beneficiaries %}
                        <div class="beneficiary-item">
                            <div class="beneficiary-avatar">
                                {{ beneficiary.nom[0]}}{{ beneficiary.prenom[0] if beneficiary.prenom else '' }}
                            </div>
                            <div class="beneficiary-info">
                                <h5>{{ beneficiary.nom }} {{ beneficiary.prenom if beneficiary.prenom else '' }}</h5>
                                <p class="text-muted">{{ beneficiary.adresse }}</p>
                                {% if beneficiary.description_situation %}
                                <p class="beneficiary-situation">{{ beneficiary.description_situation }}</p>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="col-md-4">
                <!-- Case Info Sidebar -->
                <div class="sidebar-card">
                    <h4>{{ t.case_details }}</h4>
                    <div class="sidebar-item">
                        <i class="bi bi-calendar3"></i>
                        <div>
                            <label>{{ t.publication_date }}</label>
                            <p>{{ case.date_publication }}</p>
                        </div>
                    </div>
                    <div class="sidebar-item">
                        <i class="bi bi-geo-alt-fill"></i>
                        <div>
                            <label>{{ t.address }}</label>
                            <p>{{ case.adresse }}</p>
                        </div>
                    </div>
                    <div class="sidebar-item">
                        <i class="bi bi-tag-fill"></i>
                        <div>
                            <label>{{ t.status }}</label>
                            <p>{{ t.get(case.statut, case.statut) }}</p>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons mt-4">
                    <a href="{{ url_for('edit_case', id=case.id_cas_social) }}" class="btn btn-primary w-100 mb-2">
                        <i class="bi bi-pencil-square me-2"></i>{{ t.edit }}
                    </a>
                    <a href="{{ url_for('delete_case', id=case.id_cas_social) }}" class="btn btn-danger w-100 mb-2"
                        onclick="return confirm('{{ t.confirm_delete }}')">
                        <i class="bi bi-trash me-2"></i>{{ t.delete }}
                    </a>
                    <a href="{{ url_for('ong_profile') }}" class="btn btn-outline-secondary w-100">
                        <i class="bi bi-arrow-left me-2"></i>{{ t.back_to_profile }}
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .case-details-wrapper {
        padding: 2rem 0;
    }

    .breadcrumb {
        background: transparent;
        padding: 0;
    }

    .breadcrumb a {
        color: #667eea;
        text-decoration: none;
    }

    .breadcrumb a:hover {
        color: #764ba2;
    }

    .case-detail-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 2rem;
        border-radius: 1rem;
        color: white;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }

    .case-detail-title {
        font-size: 2rem;
        font-weight: 700;
        margin: 0;
    }

    .status-badge-large {
        padding: 0.75rem 1.5rem;
        border-radius: 50px;
        font-size: 1rem;
        font-weight: 600;
        display: inline-block;
    }

    .status-urgent {
        background: #fff;
        color: #c00;
    }

    .status-en_cours {
        background: #fff;
        color: #1976d2;
    }

    .status-r√©solu {
        background: #fff;
        color: #388e3c;
    }

    .info-card {
        background: white;
        border-radius: 1rem;
        padding: 2rem;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
    }

    .card-icon {
        width: 50px;
        height: 50px;
        border-radius: 0.75rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        margin-bottom: 1rem;
    }

    .info-card h3 {
        color: #2d3748;
        font-weight: 700;
        margin-bottom: 1rem;
    }

    .case-description-full {
        color: #4a5568;
        line-height: 1.8;
        font-size: 1.05rem;
    }

    .media-gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1.5rem;
    }

    .media-item {
        border-radius: 0.75rem;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .media-item:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .media-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        cursor: pointer;
    }

    .media-video {
        width: 100%;
        border-radius: 0.75rem;
    }

    .beneficiaries-list {
        margin-top: 1.5rem;
    }

    .beneficiary-item {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 1rem;
        background: #f7fafc;
        border-radius: 0.75rem;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
    }

    .beneficiary-item:hover {
        background: #edf2f7;
        transform: translateX(5px);
    }

    .beneficiary-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1.1rem;
        flex-shrink: 0;
    }

    .beneficiary-info h5 {
        margin: 0;
        color: #2d3748;
        font-weight: 600;
    }

    .beneficiary-info p {
        margin: 0.25rem 0 0;
        font-size: 0.9rem;
    }

    .beneficiary-situation {
        margin-top: 0.5rem;
        color: #4a5568;
        font-size: 0.95rem;
    }

    .sidebar-card {
        background: white;
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
    }

    .sidebar-card h4 {
        color: #2d3748;
        font-weight: 700;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #e2e8f0;
    }

    .sidebar-item {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .sidebar-item i {
        color: #667eea;
        font-size: 1.5rem;
        flex-shrink: 0;
    }

    .sidebar-item label {
        display: block;
        color: #a0aec0;
        font-size: 0.85rem;
        margin-bottom: 0.25rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .sidebar-item p {
        color: #2d3748;
        font-weight: 500;
        margin: 0;
    }

    .action-buttons .btn {
        border-radius: 0.75rem;
        padding: 0.75rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .action-buttons .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    /* RTL Support */
    [dir="rtl"] .beneficiary-item:hover {
        transform: translateX(-5px);
    }

    [dir="rtl"] .sidebar-item i,
    [dir="rtl"] .action-buttons i {
        margin-right: 0;
        margin-left: 0.5rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .case-detail-title {
            font-size: 1.5rem;
        }

        .text-end {
            text-align: left !important;
            margin-top: 1rem;
        }

        .media-gallery {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}